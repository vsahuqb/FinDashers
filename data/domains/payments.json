{
  "domainDescription": "Adyen payment processing domain for Quick Service Restaurant (QSR) transactions. Supports analysis of payment transactions, revenue reporting, employee performance, and failed payment investigation.",
  
  "systemPromptInstructions": "You are a SQL expert specializing in Adyen payment data analysis for Quick Service Restaurant operations. Generate precise SQL queries to analyze payment transactions, revenue, employee performance, and payment failures. Always use table aliases and proper joins. Return only the SQL query without explanations unless specifically requested.",
  
  "userPrompt": "question: ",
  
  "annotatedSqlDefinitions": "-- Main payment transactions table containing Adyen webhook data\nCREATE TABLE payment_transactions (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,           -- Auto-incrementing transaction ID\n    merchant_reference TEXT,                        -- Merchant's internal reference\n    psp_reference TEXT UNIQUE,                      -- Adyen's unique payment reference\n    merchant_order_reference TEXT,                  -- Order reference from POS system\n    check_id TEXT,                                  -- Restaurant check/ticket ID\n    amount_value INTEGER,                           -- Payment amount in cents\n    amount_currency TEXT,                           -- Currency code (USD, EUR, etc.)\n    event_code TEXT,                                -- Payment event (AUTHORISATION, REFUND, etc.)\n    success BOOLEAN,                                -- Payment success status (1=success, 0=failed)\n    payment_method TEXT,                            -- Payment method (mc, visa, amex, etc.)\n    event_date DATETIME,                            -- When the payment event occurred\n    location_id TEXT,                               -- Restaurant location identifier\n    company_id TEXT,                                -- Company/brand identifier\n    employee_id TEXT,                               -- Employee who processed the transaction\n    terminal_id TEXT,                               -- Payment terminal identifier\n    store_id TEXT,                                  -- Store identifier\n    order_type_id TEXT,                             -- Order type (dine-in, takeout, delivery)\n    meal_period_id TEXT,                            -- Meal period (breakfast, lunch, dinner)\n    total_amount DECIMAL(10,2),                     -- Total order amount in dollars\n    subtotal_amount DECIMAL(10,2),                  -- Subtotal before tax\n    tax_amount DECIMAL(10,2),                       -- Tax amount\n    card_bin TEXT,                                  -- First 6 digits of card (for fraud detection)\n    card_summary TEXT,                              -- Last 4 digits of card\n    tender_reference TEXT,                          -- Reference for tender/payment method\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP   -- Record creation timestamp\n);\n\n-- Restaurant locations reference table\nCREATE TABLE locations (\n    location_id TEXT PRIMARY KEY,                   -- Unique location identifier\n    location_name TEXT,                             -- Human-readable location name\n    company_id TEXT,                                -- Parent company ID\n    store_id TEXT                                   -- Associated store ID\n);\n\n-- Restaurant employees reference table\nCREATE TABLE employees (\n    employee_id TEXT PRIMARY KEY,                   -- Unique employee identifier\n    employee_name TEXT,                             -- Employee full name\n    location_id TEXT                                -- Primary work location\n);",
  
  "joinHints": "-- Common JOIN patterns for payment analysis:\n-- For location details: INNER JOIN locations l ON pt.location_id = l.location_id\n-- For employee details: INNER JOIN employees e ON pt.employee_id = e.employee_id\n-- For revenue by location: GROUP BY pt.location_id, l.location_name\n-- For employee performance: GROUP BY pt.employee_id, e.employee_name\n-- Always use table aliases: pt for payment_transactions, l for locations, e for employees",
  
  "tableNames": [
    "payment_transactions",
    "locations", 
    "employees"
  ],
  
  "sqlPreamblePt1": [
    "-- Set date format for consistent date handling",
    "pragma table_info(payment_transactions);",
    "-- Create indexes for better query performance if needed"
  ],
  
  "sqlPreamblePt2": [
    "-- Common CTEs and temp tables can be defined here",
    "-- Example: WITH daily_totals AS (SELECT DATE(event_date) as day, SUM(total_amount) as revenue FROM payment_transactions WHERE success = 1 GROUP BY DATE(event_date))"
  ],
  
  "fewShotExamples": "Q: Show me all failed payments today\nA: SELECT pt.psp_reference, pt.merchant_reference, pt.check_id, pt.total_amount, pt.payment_method, pt.event_date, l.location_name, e.employee_name FROM payment_transactions pt INNER JOIN locations l ON pt.location_id = l.location_id INNER JOIN employees e ON pt.employee_id = e.employee_id WHERE pt.success = 0 AND DATE(pt.event_date) = DATE('now');\n\nQ: What's the total revenue for location 115?\nA: SELECT l.location_name, SUM(pt.total_amount) as total_revenue, COUNT(*) as transaction_count FROM payment_transactions pt INNER JOIN locations l ON pt.location_id = l.location_id WHERE pt.location_id = '115' AND pt.success = 1;\n\nQ: Which employee processed the most transactions?\nA: SELECT e.employee_name, e.employee_id, COUNT(*) as transaction_count, SUM(pt.total_amount) as total_processed FROM payment_transactions pt INNER JOIN employees e ON pt.employee_id = e.employee_id WHERE pt.success = 1 GROUP BY e.employee_id, e.employee_name ORDER BY transaction_count DESC LIMIT 1;\n\nQ: Show payments for check ID 692cb24db93afd5132436601\nA: SELECT pt.*, l.location_name, e.employee_name FROM payment_transactions pt INNER JOIN locations l ON pt.location_id = l.location_id INNER JOIN employees e ON pt.employee_id = e.employee_id WHERE pt.check_id = '692cb24db93afd5132436601';\n\nQ: Show today's revenue by payment method\nA: SELECT pt.payment_method, SUM(pt.total_amount) as revenue, COUNT(*) as transaction_count FROM payment_transactions pt WHERE pt.success = 1 AND DATE(pt.event_date) = DATE('now') GROUP BY pt.payment_method ORDER BY revenue DESC;\n\nQ: Find all transactions over $50\nA: SELECT pt.psp_reference, pt.check_id, pt.total_amount, pt.payment_method, pt.event_date, l.location_name FROM payment_transactions pt INNER JOIN locations l ON pt.location_id = l.location_id WHERE pt.total_amount > 50.00 AND pt.success = 1 ORDER BY pt.total_amount DESC;",
  
  "databasePath": "data/databases/payments.db"
}